<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraMart - Your Modern Online Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for a clean, modern look */
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f3f0; /* Soft off-white background */
            color: #333;
        }
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            width: 100vw;
        }
        .hidden {
            display: none;
        }

        /* Responsive and styled Header */
        .header {
            background-color: #ffffff;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .header .logo {
            font-family: 'Playfair Display', serif; /* Use serif font for logo */
            font-weight: 700;
            font-size: 3rem; /* Made logo bigger */
            color: #333;
            text-decoration: none;
            text-align: center;
            flex-grow: 1; /* Pushes other elements to the side */
        }
        .header .logo:hover {
            color: #a55447; /* Dark terracotta on hover */
        }
        .nav-links {
            display: none; /* Hide nav links on mobile */
        }
        .nav-links-desktop {
            display: none;
            justify-content: center;
            gap: 2rem;
            width: 100%;
        }
        .nav-links-desktop a {
            color: #555;
            font-weight: 600;
            font-size: 1rem;
            transition: color 0.2s ease-in-out;
            text-transform: uppercase;
        }
        .nav-links-desktop a:hover {
            color: #a55447;
        }
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
            font-size: 2rem; /* Made icon buttons bigger */
            color: #555;
            padding: 0.5rem;
            transition: color 0.2s;
        }
        .icon-btn:hover {
            color: #a55447;
        }
        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #a55447;
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transform: translate(50%, -50%);
        }
        .header-links-right, .header-links-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Main content and sections */
        .main-content {
            flex-grow: 1;
            padding: 2rem 4rem;
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
        }
        .hero-section {
            background-color: #f7f3f0;
            padding: 4rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
            height: auto;
            border-radius: 12px;
            box-shadow: none; /* Removed hero shadow to match screenshot */
        }
        .hero-content {
            background: none;
            padding: 0;
            border-radius: 0;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
        .hero-section h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -1px;
            color: #333;
        }
        .hero-section p {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.25rem;
            margin-bottom: 2rem;
            color: #555;
        }
        .btn-cta {
            background-color: #a55447;
            color: #fff;
            padding: 1rem 2.5rem;
            font-weight: 700;
            border-radius: 8px;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-cta:hover {
            background-color: #924b3c;
        }
        
        /* Promos Section */
        .promo-grid {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 1.5rem;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .promo-grid::-webkit-scrollbar {
            display: none;
        }
        .promo-grid a {
            flex-shrink: 0;
            width: 400px;
            height: 180px;
        }
        .promo-grid img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .promo-grid img:hover {
            transform: scale(1.05);
        }
        .promo-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: -2rem;
            margin-bottom: 2rem;
        }
        .promo-nav-btn {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            padding: 0.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.2s;
        }
        .promo-nav-btn:hover {
            background-color: #f0f0f0;
        }

        /* Product and Category grids */
        .category-grid, .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .category-card {
            background-color: #f7f3f0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .category-card:hover {
            background-color: #f0f0f0;
            border-color: #a55447;
            color: #a55447;
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .product-card {
            background-color: #f7f3f0;
            border-radius: 12px;
            box-shadow: none;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
            position: relative;
        }
        .product-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform: translateY(-5px);
            background-color: #fceee9;
        }
        .product-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 12px;
        }
        .product-card-body {
            padding: 1.5rem;
            text-align: center;
        }
        .product-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-decoration: none;
            height: 3rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .product-card .price {
            font-size: 1.5rem;
            font-weight: 800;
            color: #a55447;
            margin-top: 0.5rem;
            font-size: text-xl;
        }
        .product-card .category {
            font-size: 0.9rem;
            color: #777;
        }
        
        /* Button styles */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background-color: #a55447;
            color: #FFFFFF;
            border: 1px solid #a55447;
        }
        .btn-primary:hover {
            background-color: #fff;
            color: #a55447;
        }
        .btn-secondary {
            background-color: #E0E0E0;
            color: #333;
            border: 1px solid #E0E0E0;
        }
        .btn-secondary:hover {
            background-color: #ccc;
            border-color: #ccc;
        }
        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 1rem;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* Product Detail Page Styles */
        #product-detail-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .product-image-container {
            width: 100%;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .product-image-container img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.5s ease-in-out;
            cursor: zoom-in;
        }
        
        #product-detail-page h2 { 
            font-size: 5xl; /* Made product name bigger */
            font-weight: 800; 
        }
        #product-detail-page p { 
            font-size: 1.25rem; /* Made product description bigger */
            line-height: 1.6; 
        }
        #product-detail-page .price { 
            font-size: 6xl; /* Made product price bigger */
            color: #a55447; 
        }
        #reviews-section h3 {
            font-size: 4xl; /* Made customer reviews heading bigger */
        }
        #reviews-section h4 {
            font-size: 3xl; /* Made submit review heading bigger */
        }
        #reviews-section .review-div {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 1rem;
        }
        #reviews-display-area .review-div span,
        #reviews-display-area .review-div p {
            font-size: 1.2rem; /* Made review text bigger */
        }
        
        /* "Best Seller" tag style */
        .best-seller-tag {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: #a55447;
            color: #fff;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 9999px;
        }

        /* Login Card Size */
        #login-page .bg-white {
            width: 100%;
            max-width: 700px;
            padding: 6rem 4rem;
            min-height: 600px;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Responsive breakpoints */
        @media (min-width: 768px) {
            .header {
                padding: 1.5rem 3rem;
            }
            .header .logo {
                margin: 0;
            }
            .header > .flex {
                display: flex;
            }
            .nav-links {
                display: flex;
            }
            .hero-section h1 {
                font-size: 4rem;
            }
            .hero-section p {
                font-size: 1.5rem;
            }
            .category-grid, .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            #product-detail-content {
                flex-direction: row;
            }
            #product-detail-content .product-image-container {
                width: 50%;
            }
            #product-detail-page h2 { font-size: 3.5rem; }
        }
        @media (min-width: 1024px) {
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 1200px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="login-page" class="flex flex-col items-center justify-center min-h-screen bg-[#f7f3f0] p-4">
            <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-lg">
                <h1 class="text-3xl font-bold text-center mb-6">Welcome to AuraMart</h1>
                <p class="text-center text-gray-600 mb-6">Log in to unlock exclusive deals and offers.</p>
                <input type="email" id="email" placeholder="Email" class="form-control" autocomplete="email">
                <input type="password" id="password" placeholder="Password" class="form-control mb-4" autocomplete="current-password">
                <button id="login-btn" class="btn btn-primary w-full">Sign In</button>
                <p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden"></p>
            </div>
        </div>

        <div id="main-page" class="hidden">
            <header class="header">
                <div class="header-links-left flex items-center gap-4">
                    <button id="search-icon-btn" class="icon-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                </div>
                <a href="#main" class="logo">AuraMart</a>
                <div class="header-links-right flex items-center gap-4">
                    <button id="sign-out-btn" class="text-lg text-gray-600 hover:text-black transition-colors">Sign Out</button>
                    <button id="cart-icon" class="icon-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                        <span id="cart-count" class="cart-count hidden">0</span>
                    </button>
                </div>
            </header>
            <div class="main-content">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1 class="text-4xl">Discover Your Next Favorite Thing</h1>
                        <p class="mt-4">Explore our curated collection of products and find what you love.</p>
                        <a href="#products" class="btn btn-cta">Shop Now</a>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold mb-6">Hot Promotions</h2>
                <div class="promo-grid">
                    <a href="#category=Fashion" class="block" data-promotion-id="FASHION_SALE_BANNER" data-promotion-name="Summer Fashion Sale" data-creative-slot="Top Banner 1">
                        <img src="https://placehold.co/600x200/a55447/fff?text=Fashion+Sale+20%25+Off" alt="Fashion Sale Banner">
                    </a>
                    <a href="#category=Mobiles/Computers" class="block" data-promotion-id="ELECTRONICS_DEAL" data-promotion-name="Mega Electronics Deal" data-creative-slot="Top Banner 2">
                        <img src="https://placehold.co/600x200/6f594e/fff?text=Electronics+Mega+Deal" alt="Electronics Deal Banner">
                    </a>
                    <a href="#cart" class="block" data-promotion-id="FREE_SHIPPING_PROMO" data-promotion-name="Free Shipping Promo" data-creative-slot="Top Banner 3">
                        <img src="https://placehold.co/600x200/9b8e84/fff?text=Free+Shipping+on+Orders+$50" alt="Free Shipping Banner">
                    </a>
                </div>

                <h2 class="text-3xl font-bold mb-6 mt-12">Shop by Category</h2>
                <div id="categories-container" class="category-grid"></div>
                
                <h2 class="text-3xl font-bold mb-6 mt-12">Featured Products</h2>
                <div id="product-list" class="product-grid"></div>
            </div>
        </div>

        <div id="category-page" class="hidden">
            <header class="header">
                <button id="back-to-main-btn-category" class="btn btn-secondary text-sm">← Back</button>
                <h1 id="category-page-title" class="logo text-center flex-grow"></h1>
                <button id="cart-icon-category" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    <span id="cart-count-category" class="cart-count hidden">0</span>
                </button>
            </header>
            <div class="main-content">
                <h2 id="category-title" class="text-3xl font-bold mb-6"></h2>
                <div id="category-product-list" class="product-grid"></div>
            </div>
        </div>

        <div id="cart-page" class="hidden">
            <header class="header">
                <button id="back-to-main-btn-cart" class="btn btn-secondary text-sm">← Back</button>
                <h1 class="logo text-center flex-grow">Your Cart</h1>
                <div style="width: 24px;"></div>
            </header>
            <div class="main-content">
                <h2 class="text-3xl font-bold mb-6">Your Shopping Cart</h2>
                <div id="cart-items-container" class="space-y-4"></div>
                <div id="cart-summary" class="mt-8 pt-4 border-t border-gray-300 text-right">
                    <p class="text-xl font-semibold text-gray-800">Total: <span class="text-2xl font-bold text-[#a55447]">$<span id="cart-total">0.00</span></span></p>
                    <button id="checkout-btn" class="btn btn-primary mt-4">Proceed to Checkout</button>
                </div>
                <p id="empty-cart-message" class="text-gray-500 text-center mt-8 hidden">Your cart is empty.</p>
            </div>
        </div>

        <div id="product-detail-page" class="hidden">
            <header class="header">
                <button id="back-from-detail-btn" class="btn btn-secondary text-lg">← Back</button>
                <h1 class="logo text-center flex-grow">Product Details</h1>
                <button id="cart-icon-detail" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                    <span id="cart-count-detail" class="cart-count hidden">0</span>
                </button>
            </header>
            <div class="main-content">
                <div id="product-detail-content" class="flex flex-col lg:flex-row gap-8">
                    <div class="w-full lg:w-1/2">
                        <div class="product-image-container">
                            <img id="product-image" src="" alt="" class="w-full h-auto rounded-lg shadow-md object-cover">
                        </div>
                    </div>
                    <div class="w-full lg:w-1/2 flex flex-col">
                        <p id="product-category" class="text-lg text-gray-500 mb-2"></p>
                        <h2 id="product-name" class="text-5xl font-bold mb-2"></h2>
                        <p id="product-description" class="text-gray-700 text-xl mb-6 flex-grow"></p>
                        <div class="mt-auto">
                            <p class="text-6xl font-bold text-[#a55447] mb-6">$<span id="product-price"></span></p>
                            <button id="detail-add-to-cart-btn" class="btn btn-primary text-xl w-full">Add to Cart</button>
                            <button id="toggle-details-btn" class="btn btn-secondary text-xl w-full mt-4">Show All Details</button>
                        </div>
                    </div>
                </div>
                <div id="all-details-section" class="bg-gray-100 p-6 mt-8 rounded-lg shadow-inner hidden"></div>
                <div id="reviews-section" class="mt-8">
                    <h3 class="text-4xl font-bold mb-4">Customer Reviews</h3>
                    <div id="reviews-display-area" class="space-y-4 mb-6"></div>
                    <button id="view-reviews-btn" class="btn btn-secondary text-xl">View All Reviews</button>
                    <h4 class="text-3xl font-bold mt-8 mb-4">Submit Your Review</h4>
                    <div class="flex items-center mb-4">
                        <label for="review-rating" class="mr-2">Rating:</label>
                        <select id="review-rating" class="form-control w-auto">
                            <option value="5">5 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="2">2 Stars</option>
                            <option value="1">1 Star</option>
                        </select>
                    </div>
                    <textarea id="review-text" class="form-control" rows="4" placeholder="Write your review here..."></textarea>
                    <button id="submit-review-btn" class="btn btn-primary text-xl mt-4">Submit Review</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- EventTracker Module (Content from event-tracker.js) ---
        const EventTracker = (() => {

            // --- CONFIGURATION ---
            const cloudFunctionUrls = {
                // IMPORTANT: Replace these with your deployed Cloud Function URLs
                first_visit: 'https://asia-south1-svaraflow.cloudfunctions.net/process_first_visit_event',//'http://127.0.0.1:8081',
                session_start:'https://asia-south1-svaraflow.cloudfunctions.net/process_session_start_event',//'http://127.0.0.1:8089',
                view_item: 'https://asia-south1-svaraflow.cloudfunctions.net/process_view_item_event ',//'http://127.0.0.1:8083',
                view_promotion: 'https://asia-south1-svaraflow.cloudfunctions.net/process_view_promotion_event',//'http://127.0.0.1:8084',
                click: 'https://asia-south1-svaraflow.cloudfunctions.net/process_click_event',//'http://127.0.0.1:8080',
                scroll: 'https://asia-south1-svaraflow.cloudfunctions.net/process_scroll_event',//'http://127.0.0.1:8088',
                view_page: 'https://asia-south1-svaraflow.cloudfunctions.net/process_view_page_event',//'http://127.0.0.1:8082',
                zooming: 'https://asia-south1-svaraflow.cloudfunctions.net/process_zooming_event',// 'http://127.0.0.1:8085',
                user_reviews:'https://asia-south1-svaraflow.cloudfunctions.net/process_user_review_event ',//'http://127.0.0.1:8086',
                view_user_reviews:'https://asia-south1-svaraflow.cloudfunctions.net/process_view_user_reviews_event',//'http://127.0.0.1:8087',
                view_product_details: 'https://asia-south1-svaraflow.cloudfunctions.net/process_view_product_details_event',//'http://127.0.0.1:8090',
                session_time: 'https://asia-south1-svaraflow.cloudfunctions.net/process_session_time_event',//'http://127.0.0.1:8091',
            };

            let currentUserId = null;

            const getOrCreateUserId = () => {
                if (currentUserId) {
                    return currentUserId;
                }
                let userId = sessionStorage.getItem('user_id');
                if (userId) {
                    currentUserId = userId;
                    return userId;
                }
                userId = 'anon-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('user_id', userId);
                currentUserId = userId;
                return userId;
            };

            const setUserId = (newUserId) => {
                if (typeof newUserId === 'string' && newUserId.trim() !== '') {
                    const oldUserId = currentUserId;
                    currentUserId = newUserId;
                    sessionStorage.setItem('user_id', newUserId);
                    if (oldUserId !== newUserId) {
                        const firstVisitKey = `first_visit_tracked_for_${newUserId}`;
                        if (!sessionStorage.getItem(firstVisitKey)) {
                            track('first_visit');
                            sessionStorage.setItem(firstVisitKey, 'true');
                        }
                    }
                } else {
                    console.warn("[EventTracker] Invalid user ID provided to setUserId:", newUserId);
                }
            };

            const clearUserId = () => {
                currentUserId = null;
                sessionStorage.removeItem('user_id');
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    if (key.startsWith('first_visit_tracked_for_')) {
                        sessionStorage.removeItem(key);
                    }
                }
            };

            const getOrCreateSessionId = () => {
                let sessionId = sessionStorage.getItem(`session_id_${currentUserId}`);
                if (!sessionId) {
                    sessionId = 'session-' + currentUserId + '-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
                    sessionStorage.setItem(`session_id_${currentUserId}`, sessionId);
                }
                return sessionId;
            };

            const getDeviceData = () => {
                const userAgent = navigator.userAgent;
                let category = 'desktop';
                if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(userAgent)) {
                    category = 'tablet';
                } else if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(userAgent)) {
                    category = 'mobile';
                }
                return {
                    category: category,
                    os: navigator.platform,
                    browser: getBrowserName(userAgent)
                };
            };

            const getBrowserName = (userAgent) => {
                if (userAgent.indexOf("Firefox") > -1) return "Firefox";
                if (userAgent.indexOf("Edg") > -1) return "Edge";
                if (userAgent.indexOf("Chrome") > -1) return "Chrome";
                if (userAgent.indexOf("Safari") > -1) return "Safari";
                if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) return "Opera";
                if (userAgent.indexOf("MSIE") > -1 || userAgent.indexOf("Trident") > -1) return "IE";
                return "Unknown";
            };

            const getGeoData = () => {
                return {
                    country: 'IN',
                    region: 'KA',
                    city: 'Bengaluru'
                };
            };

            const getTrafficSource = () => {
                const referrer = document.referrer;
                let source = 'direct';
                let medium = '(none)';
                if (referrer) {
                    try {
                        const url = new URL(referrer);
                        source = url.hostname;
                        medium = 'referral';
                    } catch (e) {
                        source = referrer;
                        medium = 'referral';
                    }
                }
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('utm_source')) source = urlParams.get('utm_source');
                if (urlParams.has('utm_medium')) medium = urlParams.get('utm_medium');
                return { source, medium };
            };

            const track = (eventName, specificPayload = {}) => {
                const url = cloudFunctionUrls[eventName];
                if (!url || url.includes('YOUR_PROJECT_ID')) {
                    console.warn(`[EventTracker] Not tracking event '${eventName}'. Please configure your Cloud Function URL in the cloudFunctionUrls object.`);
                    console.log(`[EventTracker] Payload that would have been sent:`, specificPayload);
                    return;
                }
                
                const commonPayload = {
                    event_name: eventName,
                    event_timestamp: new Date().toISOString(),
                    user_id: getOrCreateUserId(),
                    session_id: getOrCreateSessionId(),
                    page_location: window.location.href,
                    page_title: document.title,
                    device: getDeviceData(),
                    geo: getGeoData(),
                    traffic_source: getTrafficSource(),
                };
                const finalPayload = { ...commonPayload };
                if (specificPayload.item) {
                    finalPayload.item = specificPayload.item;
                }
                if (specificPayload.promotion) {
                    finalPayload.promotion = {
                        promotion_id: specificPayload.promotion.promotion_id,
                        promotion_name: specificPayload.promotion.promotion_name,
                        creative_name: specificPayload.promotion.creative_name // Changed from 'creative_slot' to 'creative_name'
                    };
                }
                if (eventName === 'user_reviews') {
                    finalPayload.item = specificPayload.item;
                    finalPayload.review = specificPayload.review;
                }
                if (specificPayload.scroll_depth_percentage) {
                    finalPayload.scroll_depth_percentage = specificPayload.scroll_depth_percentage;
                }
                if (specificPayload.zoom_level) {
                    finalPayload.zoom_level = specificPayload.zoom_level;
                }
                if (specificPayload.viewed_reviews_count && eventName === 'view_user_reviews') {
                    finalPayload.viewed_reviews_count = specificPayload.viewed_reviews_count;
                    finalPayload.item = specificPayload.item;
                }
                if (specificPayload.session_duration) {
                    finalPayload.session_duration = specificPayload.session_duration;
                }
                const payload = JSON.stringify(finalPayload);
                console.log(`[EventTracker] Preparing to send event: ${eventName}`);
                console.log(`[EventTracker] Target URL: ${url}`);
                console.log(`[EventTracker] Payload (JSON string):`, payload);
                console.log(`[EventTracker] Payload (Parsed Object):`, finalPayload);
                fetch(url, {
                    method: 'POST',
                    body: payload,
                    headers: { 'Content-Type': 'application/json' },
                    keepalive: true
                })
                .then(response => {
                    console.log(`[EventTracker] Fetch response status for ${eventName}:`, response.status);
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP error! status: ${response.status}, body: ${text}`);
                        });
                    }
                    return response.text();
                })
                .then(responseText => {
                    console.log(`[EventTracker] Fetch response body for ${eventName}:`, responseText);
                })
                .catch(error => {
                    console.error(`[EventTracker] Error sending event ${eventName}:`, error);
                });
                console.log(`[EventTracker] Fired Event: ${eventName}`);
            };

            const SESSION_TIMEOUT_MS = 30 * 60 * 1000;
            let inactivityTimer;
            let lastActivityTime;
            const resetInactivityTimer = () => {
                clearTimeout(inactivityTimer);
                lastActivityTime = Date.now();
                sessionStorage.setItem(`session_last_activity_${currentUserId}`, lastActivityTime);
                inactivityTimer = setTimeout(endCurrentSession, SESSION_TIMEOUT_MS);
            };
            const endCurrentSession = () => {
                if (!currentUserId || !sessionStorage.getItem(`session_id_${currentUserId}`)) {
                    return;
                }
                const sessionStartTimeMs = parseInt(sessionStorage.getItem(`session_start_time_${currentUserId}`) || Date.now());
                const sessionDurationSeconds = Math.round((Date.now() - sessionStartTimeMs) / 1000);
                track('session_time', { session_duration: sessionDurationSeconds });
                sessionStorage.removeItem(`session_id_${currentUserId}`);
                sessionStorage.removeItem(`session_start_time_${currentUserId}`);
                sessionStorage.removeItem(`session_last_activity_${currentUserId}`);
            };
            const startNewSession = () => {
                const newSessionId = 'session-' + currentUserId + '-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
                sessionStorage.setItem(`session_id_${currentUserId}`, newSessionId);
                sessionStorage.setItem(`session_start_time_${currentUserId}`, Date.now());
                track('session_start');
                resetInactivityTimer();
            };
            const init = () => {
                getOrCreateUserId();
                const lastActivity = parseInt(sessionStorage.getItem(`session_last_activity_${currentUserId}`) || 0);
                const now = Date.now();
                if (now - lastActivity > SESSION_TIMEOUT_MS) {
                    startNewSession();
                } else {
                    resetInactivityTimer();
                }
                const firstVisitKey = `first_visit_tracked_for_${currentUserId}`;
                if (!sessionStorage.getItem(firstVisitKey)) {
                    track('first_visit');
                    sessionStorage.setItem(firstVisitKey, 'true');
                }
                track('view_page');
                ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart'].forEach(event => {
                    window.addEventListener(event, resetInactivityTimer, { passive: true });
                });
                document.body.addEventListener('click', (e) => {
                    const element = e.target.closest('button, a, input[type="submit"], [role="button"], [onclick]');
                    if (!element) return;
                    track('click');
                }, true);
                let scrollDepthsTracked = {};
                const trackScroll = () => {
                    const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
                    if (scrollableHeight <= 0) return;
                    const scrollPercent = Math.round((window.scrollY / scrollableHeight) * 100);
                    const depthsToTrack = [25, 50, 75, 90];
                    depthsToTrack.forEach(depth => {
                        if (scrollPercent >= depth && !scrollDepthsTracked[depth]) {
                            track('scroll', { scroll_depth_percentage: depth });
                            scrollDepthsTracked[depth] = true;
                        }
                    });
                };
                const resetScrollTracker = () => { scrollDepthsTracked = {}; };
                window.addEventListener('hashchange', resetScrollTracker);
                window.addEventListener('scroll', trackScroll, { passive: true });
                window.addEventListener('wheel', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        const zoomDelta = e.deltaY;
                        track('zooming', { zoom_level: zoomDelta });
                    }
                }, { passive: false });
                window.addEventListener('beforeunload', EventTracker._endCurrentSessionInternal);
            };
            return {
                init,
                track,
                setUserId,
                clearUserId,
                _endCurrentSessionInternal: endCurrentSession
            };
        })();

        // --- Mock Product Data ---
        const products = [
            { id: 'f001', name: 'Elegant Evening Dress', category: 'Fashion', price: 89.99, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Dress', description: 'A stunning dress perfect for evening events. Made from high-quality silk blend.', brand: 'Glamourous Attire', variant: 'Blue-Large' },
            { id: 'f002', name: 'Men\'s Slim Fit Shirt', category: 'Fashion', price: 34.99, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Shirt', description: 'A crisp, slim-fit shirt made from 100% breathable cotton. Ideal for work or casual wear.', brand: 'Gentleman\'s Choice', variant: 'White-Medium' },
            { id: 'f003', name: 'High-Waisted Denim Jeans', category: 'Fashion', price: 49.99, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Jeans', description: 'Classic high-waisted denim jeans with a modern fit. Durable and stylish.', brand: 'Denim Dreams', variant: 'Blue-Size28' },
            { id: 'f004', name: 'Classic Summer Hat', category: 'Fashion', price: 18.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Hat', description: 'Protect yourself from the sun with this timeless and fashionable summer hat.', brand: 'SunShield', variant: 'Straw-Beige' },
            { id: 'f005', name: 'Women\'s Floral Blouse', category: 'Fashion', price: 27.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Blouse', description: 'A beautiful floral blouse perfect for spring and summer.', brand: 'BloomWear', variant: 'Multi-color-S' },
            { id: 'f006', name: 'Sporty Sneakers', category: 'Fashion', price: 65.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Sneakers', description: 'Comfortable and stylish sneakers for everyday wear.', brand: 'StrideFoot', variant: 'Black-Size9' },
            { id: 'f007', name: 'Leather Crossbody Bag', category: 'Fashion', price: 120.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Bag', description: 'A chic and practical leather bag with adjustable strap.', brand: 'Elegance Carry', variant: 'Brown' },
            { id: 'f008', name: 'Cozy Knit Sweater', category: 'Fashion', price: 55.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Sweater', description: 'Soft and warm knit sweater, perfect for chilly evenings.', brand: 'WarmWeave', variant: 'Grey-L' },
            { id: 'f009', name: 'Aviator Sunglasses', category: 'Fashion', price: 25.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Sunglasses', description: 'Classic aviator sunglasses with UV protection.', brand: 'VisionPro', variant: 'Gold Frame' },
            { id: 'f010', name: 'Running Shorts', category: 'Fashion', price: 29.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Shorts', description: 'Lightweight and breathable shorts for your runs.', brand: 'ActiveFit', variant: 'Black-M' },
            { id: 'f011', name: 'Wool Blend Scarf', category: 'Fashion', price: 22.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Scarf', description: 'Soft and warm scarf, ideal for cold weather.', brand: 'WinterWarmth', variant: 'Red Plaid' },
            { id: 'f012', name: 'Classic Leather Belt', category: 'Fashion', price: 30.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Belt', description: 'Durable and stylish leather belt for any outfit.', brand: 'BeltMaster', variant: 'Black-34' },
            { id: 'f013', name: 'Striped T-Shirt', category: 'Fashion', price: 19.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=T-Shirt', description: 'Comfortable cotton t-shirt with classic stripes.', brand: 'CasualComfort', variant: 'Navy Stripe-S' },
            { id: 'f014', name: 'Plaid Flannel Shirt', category: 'Fashion', price: 42.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Flannel+Shirt', description: 'Warm and cozy flannel shirt, perfect for casual wear.', brand: 'Lumberjack Style', variant: 'Red Plaid-L' },
            { id: 'f015', name: 'Ballet Flats', category: 'Fashion', price: 38.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Flats', description: 'Elegant and comfortable ballet flats for everyday.', brand: 'Graceful Steps', variant: 'Black-Size7' },
            { id: 'f016', name: 'Sportswear Leggings', category: 'Fashion', price: 35.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Leggings', description: 'Flexible and breathable leggings for workouts or leisure.', brand: 'FlexActive', variant: 'Grey-M' },
            { id: 'f017', 'name': 'Denim Jacket', category: 'Fashion', price: 75.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Jacket', description: 'Timeless denim jacket, a versatile wardrobe staple.', brand: 'Classic Denim', variant: 'Light Wash-L' },
            { id: 'f018', name: 'Boho Maxi Skirt', category: 'Fashion', price: 45.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Skirt', description: 'Flowy and comfortable maxi skirt with a bohemian print.', brand: 'FreeSpirit', variant: 'Floral-One Size' },
            { id: 'f019', name: 'Casual Hoodie', category: 'Fashion', price: 50.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Hoodie', description: 'Soft and warm hoodie for ultimate comfort.', brand: 'ComfyCo', variant: 'Navy-XL' },
            { id: 'f020', name: 'Waterproof Raincoat', category: 'Fashion', price: 60.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Raincoat', description: 'Stay dry in style with this lightweight waterproof raincoat.', brand: 'RainGuard', variant: 'Yellow-M' },


            // Mobiles/Computers - 20 products
            { id: 'm001', name: 'Flagship Smartphone Pro', category: 'Mobiles/Computers', price: 999.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smartphone', description: 'The latest flagship smartphone with a stunning display and pro-grade camera system.', brand: 'ApexTech', variant: 'Midnight Black-512GB' },
            { id: 'm002', name: 'Ultra-Thin Laptop Air', category: 'Mobiles/Computers', price: 1350.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Laptop', description: 'Incredibly light and powerful, this laptop is perfect for professionals on the go.', brand: 'FeatherLight', variant: 'Silver-16GB RAM' },
            { id: 'm003', name: 'Noise-Cancelling Headphones', category: 'Mobiles/Computers', price: 149.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Headphones', description: 'Immerse yourself in sound with these top-tier noise-cancelling headphones.', brand: 'SoundScape', variant: 'Matte Black' },
            { id: 'm004', name: 'Gaming Desktop PC', category: 'Mobiles/Computers', price: 1800.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Gaming+PC', description: 'High-performance gaming PC for an unparalleled gaming experience.', brand: 'GamerForge', variant: 'RTX 4070-16GB RAM' },
            { id: 'm005', name: 'Wireless Ergonomic Mouse', category: 'Mobiles/Computers', price: 45.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Mouse', description: 'Comfortable and precise wireless mouse for extended use.', brand: 'ErgoGlide', variant: 'Graphite' },
            { id: 'm006', name: '4K UHD Monitor', category: 'Mobiles/Computers', price: 350.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Monitor', description: 'Stunning 4K resolution monitor for crystal-clear visuals.', brand: 'VividDisplay', variant: '27-inch' },
            { id: 'm007', name: 'Portable SSD 1TB', category: 'Mobiles/Computers', price: 110.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=SSD', description: 'Fast and compact external solid-state drive for all your data.', brand: 'SpeedyStore', variant: 'USB-C' },
            { id: 'm008', name: 'Smartwatch Series X', category: 'Mobiles/Computers', price: 299.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smartwatch', description: 'Stay connected and track your fitness with this advanced smartwatch.', brand: 'HealthTech', variant: 'Midnight Blue' },
            { id: 'm009', name: 'Webcam Pro HD', category: 'Mobiles/Computers', price: 75.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Webcam', description: 'High-definition webcam for clear video calls and streaming.', brand: 'StreamCam', variant: '1080p' },
            { id: 'm010', name: 'Mesh Wi-Fi System', category: 'Mobiles/Computers', price: 199.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Mesh+WiFi', description: 'Eliminate dead zones with seamless whole-home Wi-Fi coverage.', brand: 'HomeNet', variant: '3-Pack' },
            { id: 'm011', name: 'External Hard Drive 2TB', category: 'Mobiles/Computers', price: 80.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=External+HDD', description: 'Reliable storage for all your backups and large files.', brand: 'DataVault', variant: 'USB 3.0' },
            { id: 'm012', name: 'Bluetooth Keyboard', category: 'Mobiles/Computers', price: 60.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Keyboard', description: 'Compact and portable keyboard for all your devices.', brand: 'Typemaster', variant: 'Compact Layout' },
            { id: 'm013', name: 'Portable Bluetooth Speaker', category: 'Mobiles/Computers', price: 70.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Speaker', description: 'Enjoy high-quality sound on the go with this portable speaker.', brand: 'AudioGo', variant: 'Blue' },
            { id: 'm014', name: 'Graphics Tablet', category: 'Mobiles/Computers', price: 250.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Tablet', description: 'Perfect for digital artists and designers.', brand: 'ArtFlow', variant: 'Medium Size' },
            { id: 'm015', name: 'USB-C Hub Multiport Adapter', category: 'Mobiles/Computers', price: 40.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=USB-C+Hub', description: 'Expand your laptop\'s connectivity with this versatile hub.', brand: 'ConnectAll', variant: '7-in-1' },
            { id: 'm016', name: 'Wireless Charging Pad', category: 'Mobiles/Computers', price: 25.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Charger', description: 'Convenient and fast wireless charging for compatible devices.', brand: 'PowerBeam', variant: 'Fast Charge' },
            { id: 'm017', name: 'Digital Camera Mirrorless', category: 'Mobiles/Computers', price: 750.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Camera', description: 'Capture stunning photos and videos with this compact mirrorless camera.', brand: 'LensCrafter', variant: 'APS-C' },
            { id: 'm018', name: 'VR Headset immersive', category: 'Mobiles/Computers', price: 399.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=VR+Headset', description: 'Step into virtual worlds with this immersive VR headset.', brand: 'RealityDive', variant: 'Standalone' },
            { id: 'm019', name: 'Smart Home Speaker with AI', category: 'Mobiles/Computers', price: 120.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smart+Speaker', description: 'Voice-controlled smart speaker with integrated AI assistant.', brand: 'EchoHome', variant: 'Gen 4' },
            { id: 'm020', name: 'Portable Power Bank 20000mAh', category: 'Mobiles/Computers', price: 50.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Power+Bank', description: 'Keep your devices charged on the go with this high-capacity power bank.', brand: 'JuiceBox', variant: 'USB-PD' },

            // Home - 20 products
            { id: 'h001', name: 'Smart Home Hub', category: 'Home', price: 79.99, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smart+Hub', description: 'Centralized control for all your smart home devices.', brand: 'ConnectCentral', variant: 'Gen 2' },
            { id: 'h002', name: 'Robotic Vacuum Cleaner', category: 'Home', price: 299.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Robot+Vacuum', description: 'Automate your cleaning with this intelligent robotic vacuum.', brand: 'CleanBot', variant: 'Self-Emptying' },
            { id: 'h003', name: 'Air Fryer XL', category: 'Home', price: 89.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Air+Fryer', description: 'Cook healthier meals with less oil using this large capacity air fryer.', brand: 'CrispyCook', variant: '5.8QT' },
            { id: 'h004', name: 'Coffee Maker Pro', category: 'Home', price: 120.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Coffee+Maker', description: 'Brew perfect coffee every time with this professional-grade machine.', brand: 'BrewMaster', variant: '12-Cup' },
            { id: 'h005', name: 'LED Smart Lighting Kit', category: 'Home', price: 59.99, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smart+Lights', description: 'Customize your home ambiance with smart, color-changing LED lights.', brand: 'LumiSmart', variant: 'Starter Kit' },
            { id: 'h006', name: 'Blender High-Speed', category: 'Home', price: 70.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Blender', description: 'Effortlessly blend smoothies, soups, and more with powerful motor.', brand: 'BlendForce', variant: '1000W' },
            { id: 'h007', name: 'Toaster Oven Convection', category: 'Home', price: 95.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Toaster+Oven', description: 'Bake, toast, and broil with this versatile countertop appliance.', brand: 'BakePro', variant: 'Compact' },
            { id: 'h008', name: 'Digital Kitchen Scale', category: 'Home', price: 25.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Kitchen+Scale', description: 'Precise measurements for perfect cooking and baking.', brand: 'MeasureRite', variant: 'Stainless Steel' },
            { id: 'h009', name: 'Cordless Handheld Vacuum', category: 'Home', price: 65.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Handheld+Vacuum', description: 'Quick and easy cleanup for small messes around the house.', brand: 'DustAway', variant: 'Lightweight' },
            { id: 'h010', name: 'Water Filter Pitcher', category: 'Home', price: 30.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Water+Pitcher', description: 'Enjoy cleaner, great-tasting water with this filter pitcher.', brand: 'AquaClear', variant: '2.5L' },
            { id: 'h011', name: 'Stand Mixer Pro', category: 'Home', price: 200.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Stand+Mixer', description: 'Whip, knead, and mix with ease for all your baking needs.', brand: 'KitchenAid', variant: '5-Quart' },
            { id: 'h012', name: 'Essential Oil Diffuser', category: 'Home', price: 35.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Oil+Diffuser', description: 'Create a relaxing ambiance with aromatic essential oils.', brand: 'AromaLux', variant: 'Wood Grain' },
            { id: 'h013', name: 'Smart Doorbell Camera', category: 'Home', price: 150.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Doorbell+Camera', description: 'Monitor your front door from anywhere with motion detection.', brand: 'RingSafe', variant: 'Video HD' },
            { id: 'h014', name: 'Digital Meat Thermometer', category: 'Home', price: 20.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Meat+Thermometer', description: 'Ensure perfectly cooked meats every time with instant read.', brand: 'ThermoCook', variant: 'Instant Read' },
            { id: 'h015', name: 'Slow Cooker Large Capacity', category: 'Home', price: 55.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Slow+Cooker', description: 'Prepare delicious, tender meals with minimal effort.', brand: 'CrockPot', variant: '6-Quart' },
            { id: 'h016', name: 'Indoor Plant Pot Set', category: 'Home', price: 40.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Plant+Pots', description: 'Stylish ceramic pots to enhance your indoor garden.', brand: 'GreenThumb', variant: 'Set of 3' },
            { id: 'h017', name: 'Electric Kettle Fast Boil', category: 'Home', price: 45.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Electric+Kettle', description: 'Boil water quickly and safely for tea, coffee, and more.', brand: 'RapidBoil', variant: '1.7L' },
            { id: 'h018', name: 'Handheld Garment Steamer', category: 'Home', price: 35.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Garment+Steamer', description: 'Quickly de-wrinkle clothes for a fresh look.', brand: 'SmoothFlow', variant: 'Portable' },
            { id: 'h019', name: 'Rechargeable LED Lantern', category: 'Home', price: 28.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=LED+Lantern', description: 'Portable and bright lighting for power outages or camping.', brand: 'BrightLite', variant: 'Dimmable' },
            { id: 'h020', name: 'Memory Foam Pillow', category: 'Home', price: 50.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Memory+Foam+Pillow', description: 'Ergonomic pillow for comfortable and supportive sleep.', brand: 'DreamCloud', variant: 'Standard' },

            // Books - 20 products
            { id: 'b001', name: 'The Silent Patient', category: 'Books', price: 15.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Silent+Patient', description: 'A shocking psychological thriller with a brilliant twist.', brand: 'Celadon Books', variant: 'Hardcover' },
            { id: 'b002', name: 'Atomic Habits', category: 'Books', price: 22.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Atomic+Habits', description: 'An easy & proven way to build good habits & break bad ones.', brand: 'Avery', variant: 'Paperback' },
            { id: 'b003', name: 'Where the Crawdads Sing', category: 'Books', price: 16.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Crawl+Dads+Sing', description: 'A captivating mystery and coming-of-age story.', brand: 'G.P. Putnam\'s Sons', variant: 'Paperback' },
            { id: 'b004', name: 'Dune', category: 'Books', price: 14.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Dune', description: 'The seminal science fiction epic of a desert planet and its messiah.', brand: 'Ace Books', variant: 'Paperback' },
            { id: 'b005', name: 'The Midnight Library', category: 'Books', price: 17.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Midnight+Library', description: 'A heartwarming and philosophical tale about life choices.', brand: 'Viking', variant: 'Hardcover' },
            { id: 'b006', name: 'Becoming', category: 'Books', price: 20.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Becoming', description: 'Michelle Obama\'s intimate, powerful, and inspiring memoir.', brand: 'Crown', variant: 'Hardcover' },
            { id: 'b007', name: 'Educated', category: 'Books', price: 18.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Educated', description: 'A memoir of a young girl who pursued knowledge despite a tyrannical father.', brand: 'Random House', variant: 'Paperback' },
            { id: 'b008', name: 'Sapiens: A Brief History of Humankind', category: 'Books', price: 25.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Sapiens', description: 'A sweeping history of Homo sapiens from the Stone Age to the present.', brand: 'Harper Perennial', variant: 'Paperback' },
            { id: 'b009', name: 'The Great Gatsby', category: 'Books', price: 12.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Gatsby', description: 'A classic novel of the Jazz Age, love, and the American Dream.', brand: 'Scribner', variant: 'Paperback' },
            { id: 'b010', name: 'The Alchemist', category: 'Books', price: 13.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Alchemist', description: 'An allegorical novel about a shepherd boy who journeys to find treasure.', brand: 'HarperOne', variant: 'Paperback' },
            { id: 'b011', name: 'Fahrenheit 451', category: 'Books', price: 11.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Fahrenheit+451', description: 'A dystopian novel about a future society where books are outlawed.', brand: 'Simon & Schuster', variant: 'Paperback' },
            { id: 'b012', name: '1984', category: 'Books', price: 10.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=1984', description: 'A classic dystopian social science fiction novel by George Orwell.', brand: 'Signet Classic', variant: 'Paperback' },
            { id: 'b013', name: 'To Kill a Mockingbird', category: 'Books', price: 14.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Mockingbird', description: 'A timeless novel about racial injustice and childhood in the American South.', brand: 'Grand Central Publishing', variant: 'Paperback' },
            { id: 'b014', name: 'The Hobbit', category: 'Books', price: 16.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=The+Hobbit', description: 'J.R.R. Tolkien\'s classic fantasy adventure novel.', brand: 'Ballantine Books', variant: 'Paperback' },
            { id: 'b015', name: 'Pride and Prejudice', category: 'Books', price: 9.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Pride+Prejudice', description: 'Jane Austen\'s beloved novel of manners, love, and society.', brand: 'Penguin Classics', variant: 'Paperback' },
            { id: 'b016', name: 'The Lord of the Rings', category: 'Books', price: 28.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Lord+of+Rings', description: 'The epic high-fantasy adventure by J.R.R. Tolkien.', brand: 'Houghton Mifflin Harcourt', variant: 'Box Set' },
            { id: 'b017', name: 'Gone Girl', category: 'Books', price: 15.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Gone+Girl', description: 'A thrilling mystery that explores the dark side of marriage.', brand: 'Broadway Books', variant: 'Paperback' },
            { id: 'b018', name: 'The Catcher in the Rye', category: 'Books', price: 10.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Catcher+Rye', description: 'J.D. Salinger\'s classic novel of adolescent angst and alienation.', brand: 'Little, Brown and Company', variant: 'Paperback' },
            { id: 'b019', name: 'The Road', category: 'Books', price: 13.50, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=The+Road', description: 'A post-apocalyptic novel about a father and son\'s journey.', brand: 'Vintage', variant: 'Paperback' },
            { id: 'b020', name: 'Educated', category: 'Books', price: 18.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Educated', description: 'A powerful memoir about a young girl\'s quest for knowledge.', brand: 'Random House', variant: 'Hardcover' },

            // Sports - 20 products
            { id: 's001', name: 'Yoga Mat Premium', category: 'Sports', price: 25.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Yoga+Mat', description: 'Durable and comfortable yoga mat for all your fitness needs.', brand: 'ZenFlow', variant: '6mm-Blue' },
            { id: 's002', name: 'Resistance Band Set', category: 'Sports', price: 18.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Resistance+Bands', description: 'Versatile resistance bands for full-body workouts.', brand: 'FitFlex', variant: 'Light-Heavy' },
            { id: 's003', name: 'Smart Jump Rope', category: 'Sports', price: 35.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Smart+Jump+Rope', description: 'Track your jumps and calories with this smart jump rope.', brand: 'LeapMetric', variant: 'Digital' },
            { id: 's004', name: 'Dumbbell Set Adjustable', category: 'Sports', price: 120.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Dumbbell+Set', description: 'Space-saving adjustable dumbbells for various weights.', brand: 'IronFit', variant: '5-50lbs' },
            { id: 's005', name: 'Fitness Tracker Watch', category: 'Sports', price: 80.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Fitness+Tracker', description: 'Monitor heart rate, steps, and sleep with this advanced tracker.', brand: 'PacePro', variant: 'Black' },
            { id: 's006', name: 'Cycling Helmet Aerodynamic', category: 'Sports', price: 60.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Cycling+Helmet', description: 'Lightweight and aerodynamic helmet for road cycling.', brand: 'AeroRide', variant: 'White-M' },
            { id: 's007', name: 'Basketball Official Size', category: 'Sports', price: 30.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Basketball', description: 'Durable basketball for indoor and outdoor play.', brand: 'HoopStar', variant: 'Size 7' },
            { id: 's008', name: 'Soccer Ball Training', category: 'Sports', price: 22.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Soccer+Ball', description: 'High-quality soccer ball for practice and casual games.', brand: 'KickMaster', variant: 'Size 5' },
            { id: 's009', name: 'Tennis Racket Graphite', category: 'Sports', price: 90.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Tennis+Racket', description: 'Lightweight graphite racket for enhanced power and control.', brand: 'SmashPro', variant: 'Grip 2' },
            { id: 's010', name: 'Swimming Goggles Anti-Fog', category: 'Sports', price: 15.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Swim+Goggles', description: 'Comfortable and anti-fog goggles for clear underwater vision.', brand: 'DiveClear', variant: 'Blue' },
            { id: 's011', name: 'Camping Tent 2-Person', category: 'Sports', price: 150.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Camping+Tent', description: 'Lightweight and easy-to-pitch tent for outdoor adventures.', brand: 'TrailBlazer', variant: 'Green' },
            { id: 's012', name: 'Hiking Backpack 40L', category: 'Sports', price: 70.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Hiking+Backpack', description: 'Comfortable and spacious backpack for day hikes and overnights.', brand: 'ExplorePack', variant: 'Red' },
            { id: 's013', name: 'Fishing Rod Combo', category: 'Sports', price: 55.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Fishing+Rod', description: 'Complete fishing rod and reel combo for beginners and experts.', brand: 'Angler\'s Dream', variant: 'Spinning' },
            { id: 's014', name: 'Golf Club Set Junior', category: 'Sports', price: 180.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Golf+Set+Junior', description: 'Perfect starter golf club set for aspiring young golfers.', brand: 'JuniorPro', variant: 'Ages 9-12' },
            { id: 's015', name: 'Skateboard Complete', category: 'Sports', price: 65.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Skateboard', description: 'Ready-to-ride skateboard for cruising and tricks.', brand: 'StreetGlide', variant: 'Maple Deck' },
            { id: 's016', name: 'Roller Skates Adjustable', category: 'Sports', price: 75.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Roller+Skates', description: 'Adjustable roller skates for growing feet or sharing.', brand: 'RollEasy', variant: 'Size 4-8' },
            { id: 's017', name: 'Badminton Racket Set', category: 'Sports', price: 40.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Badminton+Set', description: 'Includes rackets, shuttlecocks, and carrying case for fun games.', brand: 'ShuttlePlay', variant: '2-Player' },
            { id: 's018', name: 'Volleyball Soft Touch', category: 'Sports', price: 28.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Volleyball', description: 'Soft touch volleyball, ideal for casual play and training.', brand: 'CourtReady', variant: 'Indoor/Outdoor' },
            { id: 's019', name: 'Baseball Glove Adult', category: 'Sports', price: 50.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Baseball+Glove', description: 'Durable leather baseball glove for adult players.', brand: 'DiamondGuard', variant: '12-inch' },
            { id: 's020', name: 'Punching Bag Heavy Duty', category: 'Sports', price: 99.00, image: 'https://placehold.co/300x200/F0F0F0/D9D9D9?text=Punching+Bag', description: 'Ideal for boxing, kickboxing, and general fitness training.', brand: 'PowerPunch', variant: '100lb' },
        ];

        // --- Global State & DOM Elements ---
        let cartItems = [];
        let currentPage = 'login';
        const loginPage = document.getElementById('login-page');
        const mainPage = document.getElementById('main-page');
        const categoryPage = document.getElementById('category-page');
        const cartPage = document.getElementById('cart-page');
        const productDetailPage = document.getElementById('product-detail-page');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        const cartIconMain = document.getElementById('cart-icon');
        const cartCountMain = document.getElementById('cart-count');
        const cartIconCategory = document.getElementById('cart-icon-category');
        const cartCountCategory = document.getElementById('cart-count-category');
        const cartIconDetail = document.getElementById('cart-icon-detail');
        const cartCountDetail = document.getElementById('cart-count-detail');
        const categoriesContainer = document.getElementById('categories-container');
        const productList = document.getElementById('product-list');
        const backToMainBtnCategory = document.getElementById('back-to-main-btn-category');
        const backToMainBtnCart = document.getElementById('back-to-main-btn-cart');
        const backFromDetailBtn = document.getElementById('back-from-detail-btn');
        const productDetailImage = document.getElementById('product-image');
        const productDetailName = document.getElementById('product-name');
        const productDetailCategory = document.getElementById('product-category');
        const productDetailDescription = document.getElementById('product-description');
        const productDetailPrice = document.getElementById('product-price');
        const detailAddToCartBtn = document.getElementById('detail-add-to-cart-btn');
        const toggleDetailsBtn = document.getElementById('toggle-details-btn');
        const allDetailsSection = document.getElementById('all-details-section');
        const reviewsDisplayArea = document.getElementById('reviews-display-area');
        const reviewRatingSelect = document.getElementById('review-rating');
        const reviewTextarea = document.getElementById('review-text');
        const submitReviewBtn = document.getElementById('submit-review-btn');
        const viewReviewsBtn = document.getElementById('view-reviews-btn');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartTotalSpan = document.getElementById('cart-total');
        const checkoutBtn = document.getElementById('checkout-btn');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartSummary = document.getElementById('cart-summary');
        const signOutBtn = document.getElementById('sign-out-btn');
        const categoryPageTitle = document.getElementById('category-page-title');


        // --- Utility Functions ---

        function hideAllPages() {
            loginPage.classList.add('hidden');
            mainPage.classList.add('hidden');
            categoryPage.classList.add('hidden');
            cartPage.classList.add('hidden');
            productDetailPage.classList.add('hidden');
        }

        function showPage(pageName, options = {}) {
            hideAllPages();
            currentPage = pageName;

            let newHash = '';
            if (pageName === 'category' && options.category) {
                newHash = `category=${encodeURIComponent(options.category)}`;
            } else if (pageName === 'product-detail' && options.productId) {
                newHash = `product=${options.productId}`;
            } else if (pageName === 'cart') {
                newHash = 'cart';
            }

            if (window.location.hash.substring(1) !== newHash) {
                window.location.hash = newHash;
            }

            switch (pageName) {
                case 'login':
                    loginPage.classList.remove('hidden');
                    emailInput.value = '';
                    passwordInput.value = '';
                    loginError.classList.add('hidden');
                    break;
                case 'main':
                    mainPage.classList.remove('hidden');
                    renderCategories();
                    renderProducts(products, productList);
                    updateCartCounts();
                    break;
                case 'category':
                    categoryPage.classList.remove('hidden');
                    const filteredProducts = products.filter(p => p.category === options.category);
                    categoryPageTitle.textContent = options.category;
                    renderProducts(filteredProducts, document.getElementById('category-product-list'));
                    updateCartCounts();
                    break;
                case 'cart':
                    cartPage.classList.remove('hidden');
                    renderCart();
                    break;
                case 'product-detail':
                    productDetailPage.classList.remove('hidden');
                    renderProductDetail(options.productId);
                    updateCartCounts();
                    break;
                default:
                    showPage('login');
            }
        }

        function renderProducts(productsToRender, container) {
            container.innerHTML = '';
            if (productsToRender.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center col-span-full">No products found.</p>';
                return;
            }

            productsToRender.forEach((product, index) => {
                const isBestSeller = index < 4;
                const productCard = document.createElement('a');
                productCard.href = `#product=${product.id}`;
                productCard.className = 'product-card block';
                productCard.innerHTML = `
                    ${isBestSeller ? '<span class="best-seller-tag">Best Seller</span>' : ''}
                    <img src="${product.image}" alt="${product.name}">
                    <div class="product-card-body">
                        <p class="category">${product.category}</p>
                        <h3 class="h-12 overflow-hidden">${product.name}</h3>
                        <p class="price">$${product.price.toFixed(2)}</p>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }


        function renderProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                productDetailPage.innerHTML = '<p class="text-red-500 text-center">Product not found.</p>';
                return;
            }

            EventTracker.track('view_item', {
                item: {
                    item_id: product.id,
                    item_name: product.name,
                    price: product.price,
                    item_category: product.category
                }
            });

            productDetailImage.src = product.image;
            productDetailImage.alt = product.name;
            productDetailName.textContent = product.name;
            productDetailCategory.textContent = product.category;
            productDetailDescription.textContent = product.description;
            productDetailPrice.textContent = product.price.toFixed(2);
            detailAddToCartBtn.dataset.productId = product.id;

            const existingReviewsSection = document.getElementById('reviews-section');
            if (existingReviewsSection) existingReviewsSection.remove();
            
            renderReviewSection(productId);

            const allDetailsSection = document.getElementById('all-details-section');
            allDetailsSection.innerHTML = `
                <h5 class="text-xl font-bold mb-4">Product Specifications</h5>
                <p><strong>Brand:</strong> ${product.brand || 'N/A'}</p>
                <p><strong>Category:</strong> ${product.category || 'N/A'}</p>
                <p><strong>Variant:</strong> ${product.variant || 'N/A'}</p>
                <p><strong>Description:</strong> ${product.description || 'N/A'}</p>
                <p><strong>Product ID:</strong> ${product.id}</p>
            `;
            allDetailsSection.classList.add('hidden');
            toggleDetailsBtn.textContent = 'Show All Details';
            
            toggleDetailsBtn.onclick = () => {
                const isHidden = allDetailsSection.classList.toggle('hidden');
                toggleDetailsBtn.textContent = isHidden ? 'Show All Details' : 'Hide Details';
                if (!isHidden) {
                    EventTracker.track('view_product_details', {
                        item: {
                            item_id: product.id,
                            item_name: product.name,
                            item_category: product.category,
                            price: product.price,
                        },
                    });
                }
            };
            
            detailAddToCartBtn.onclick = (event) => {
                const id = event.target.dataset.productId;
                addToCart(id);
            };
        }


        function renderReviewSection(productId) {
            const reviewsSectionHtml = `
                <div id="reviews-section" class="mt-8">
                    <h3 class="text-4xl font-bold mb-4">Customer Reviews</h3>
                    <div id="reviews-display-area" class="space-y-4 mb-6"></div>
                    <button id="view-reviews-btn" class="btn btn-secondary text-xl">View All Reviews</button>
                    <h4 class="text-3xl font-bold mt-8 mb-4">Submit Your Review</h4>
                    <div class="flex items-center mb-4">
                        <label for="review-rating" class="mr-2">Rating:</label>
                        <select id="review-rating" class="form-control w-auto">
                            <option value="5">5 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="2">2 Stars</option>
                            <option value="1">1 Star</option>
                        </select>
                    </div>
                    <textarea id="review-text" class="form-control" rows="4" placeholder="Write your review here..."></textarea>
                    <button id="submit-review-btn" class="btn btn-primary text-xl mt-4">Submit Review</button>
                </div>
            `;
            document.querySelector('#product-detail-page .main-content').insertAdjacentHTML('beforeend', reviewsSectionHtml);

            document.getElementById('submit-review-btn').addEventListener('click', () => {
                const rating = document.getElementById('review-rating').value;
                const reviewText = document.getElementById('review-text').value.trim();
                submitReview(productId, rating, reviewText);
            });

            document.getElementById('view-reviews-btn').addEventListener('click', () => {
                renderReviews(productId);
            });
        }


        function submitReview(productId, rating, reviewText) {
            if (reviewText === "") {
                alertMessage("Please write your review before submitting.");
                return;
            }
            const product = products.find(p => p.id === productId);
            if (!product) {
                console.error('Product not found for review submission.');
                return;
            }
            
            const reviewId = 'review-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            EventTracker.track('user_reviews', {
                item: { 
                    item_id: product.id,
                    item_name: product.name,
                    item_category: product.category,
                    price: product.price,
                },
                review: { 
                    review_id: reviewId, 
                    product_id: productId,
                    rating: parseInt(rating),
                    review_text: reviewText,
                }
            });
            
            alertMessage('Review submitted! (Demo)');
            document.getElementById('review-rating').value = '5';
            document.getElementById('review-text').value = '';
        }

        function renderReviews(productId) {
            const mockReviews = [
                { user: 'Alice', rating: 5, text: 'Absolutely love this product! Highly recommend.', timestamp: '2025-07-20' },
                { user: 'Bob', rating: 4, text: 'Good quality, met my expectations.', timestamp: '2025-07-22' }
            ];

            const product = products.find(p => p.id === productId);
            if (!product) {
                console.error('Product not found for review tracking.');
                return;
            }

            EventTracker.track('view_user_reviews', {
                viewed_reviews_count: mockReviews.length,
                item: { item_id: product.id },
            });

            const reviewsDisplayArea = document.getElementById('reviews-display-area');
            reviewsDisplayArea.innerHTML = '';

            if (mockReviews.length > 0) {
                mockReviews.forEach(review => {
                    const reviewDiv = document.createElement('div');
                    reviewDiv.className = 'review-div bg-white p-4 rounded-md shadow-sm border border-gray-200';
                    reviewDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <span class="font-semibold text-[#a55447] mr-2 text-xl">${review.user}</span>
                            <span class="text-yellow-500 text-lg">${'⭐'.repeat(review.rating)}</span>
                        </div>
                        <p class="text-gray-700 text-lg mb-2">${review.text}</p>
                        <p class="text-gray-500 text-base text-right">Reviewed on ${review.timestamp}</p>
                    `;
                    reviewsDisplayArea.appendChild(reviewDiv);
                });
            } else {
                reviewsDisplayArea.innerHTML = '<p class="text-gray-500">No reviews yet. Be the first to review!</p>';
            }
        }

        function renderCategories() {
            categoriesContainer.innerHTML = '';
            const uniqueCategories = [...new Set(products.map(p => p.category))];
            uniqueCategories.forEach(category => {
                const button = document.createElement('a');
                button.className = 'category-card';
                button.textContent = category;
                button.href = `#category=${encodeURIComponent(category)}`;
                categoriesContainer.appendChild(button);
            });
        }

        function addToCart(productId) {
            const existingItem = cartItems.find(item => item.productId === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartItems.push({ productId: productId, quantity: 1 });
            }
            updateCartCounts();
            alertMessage('Product added to cart!');
        }

        function updateCartCounts() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const counts = [cartCountMain, cartIconCategory.querySelector('.cart-count'), cartIconDetail.querySelector('.cart-count')];
            counts.forEach(countEl => {
                if (totalItems > 0) {
                    countEl.textContent = totalItems;
                    countEl.classList.remove('hidden');
                } else {
                    countEl.classList.add('hidden');
                }
            });
        }

        function renderCart() {
            cartItemsContainer.innerHTML = '';
            let total = 0;
            if (cartItems.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartSummary.classList.add('hidden');
                return;
            } else {
                emptyCartMessage.classList.add('hidden');
                cartSummary.classList.remove('hidden');
            }

            cartItems.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    const itemTotal = product.price * item.quantity;
                    total += itemTotal;
                    const cartItemDiv = document.createElement('div');
                    cartItemDiv.className = 'flex items-center justify-between bg-white p-4 rounded-lg shadow-sm';
                    cartItemDiv.innerHTML = `
                        <div class="flex items-center">
                            <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md mr-4">
                            <div>
                                <h3 class="text-lg font-semibold">${product.name}</h3>
                                <p class="text-gray-600">Quantity: ${item.quantity}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-[#a55447]">$${itemTotal.toFixed(2)}</p>
                            <button class="remove-from-cart-btn text-red-500 hover:text-red-700 text-sm mt-1" data-product-id="${product.id}">Remove</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemDiv);
                }
            });
            cartTotalSpan.textContent = total.toFixed(2);
            cartItemsContainer.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const productId = event.target.dataset.productId;
                    removeItemFromCart(productId);
                });
            });
        }

        function alertMessage(message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed bottom-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-transform duration-300 transform translate-x-full';
            messageBox.textContent = message;
            document.body.appendChild(messageBox);
            setTimeout(() => {
                messageBox.classList.remove('translate-x-full');
            }, 50);
            setTimeout(() => {
                messageBox.classList.add('translate-x-full');
                messageBox.addEventListener('transitionend', () => messageBox.remove());
            }, 3000);
        }

        function removeItemFromCart(productId) {
            cartItems = cartItems.filter(item => {
                if (item.productId === productId) {
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        EventTracker.track('remove_from_cart', {
                            item: {
                                item_id: product.id,
                                item_name: product.name,
                                item_category: product.category,
                                price: product.price,
                                quantity: item.quantity
                            }
                        });
                    }
                    return false;
                }
                return true;
            });
            updateCartCounts();
            renderCart();
            alertMessage('Item removed from cart.');
        }

        function signOut() {
            EventTracker._endCurrentSessionInternal();
            cartItems = [];
            updateCartCounts();
            EventTracker.clearUserId();
            showPage('login');
            alertMessage('You have been signed out.');
        }

        function handleHashChange() {
            const hash = window.location.hash.substring(1);
            if (hash.startsWith('category=')) {
                const category = decodeURIComponent(hash.split('=')[1]);
                showPage('category', { category });
            } else if (hash.startsWith('product=')) {
                const productId = hash.split('=')[1];
                showPage('product-detail', { productId });
            } else if (hash === 'cart') {
                showPage('cart');
            } else {
                if (currentPage !== 'login') {
                    showPage('main');
                }
            }
        }

        // Event listeners
        loginBtn.addEventListener('click', () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            if (email && password) {
                const simulatedBackendUserId = `user-${email.split('@')[0]}-${Date.now()}`;
                EventTracker.setUserId(simulatedBackendUserId);
                EventTracker.init();
                loginError.classList.add('hidden');
                showPage('main');
            } else {
                loginError.classList.remove('hidden');
                loginError.textContent = 'Please enter both email and password.';
            }
        });

        [cartIconMain, cartIconCategory, cartIconDetail].forEach(icon => {
            icon.addEventListener('click', () => showPage('cart'));
        });

        backToMainBtnCategory.addEventListener('click', () => showPage('main'));
        backToMainBtnCart.addEventListener('click', () => showPage('main'));
        backFromDetailBtn.addEventListener('click', () => window.history.back());

        checkoutBtn.addEventListener('click', () => {
            if (cartItems.length > 0) {
                alertMessage('Proceeding to checkout! (This is a demo)');
                cartItems = [];
                updateCartCounts();
                renderCart();
            } else {
                alertMessage('Your cart is empty!');
            }
        });

        if (signOutBtn) {
            signOutBtn.addEventListener('click', signOut);
        }

        window.addEventListener('hashchange', handleHashChange);
        window.addEventListener('popstate', handleHashChange);

        document.addEventListener('DOMContentLoaded', () => {
            EventTracker.init();
            document.querySelectorAll('.promo-grid a').forEach(banner => {
                banner.addEventListener('click', () => {
                    const promotionId = banner.dataset.promotionId || banner.alt;
                    const promotionName = banner.dataset.promotionName || null;
                    const creativeSlot = banner.dataset.creativeSlot || null;
                    EventTracker.track('view_promotion', {
                        promotion: {
                            promotion_id: promotionId,
                            promotion_name: promotionName,
                            creative_name: creativeSlot // Correctly maps creativeSlot to creative_name
                        }
                    });
                });
            });

            if (window.location.hash) {
                handleHashChange();
            } else {
                const storedUserId = sessionStorage.getItem('user_id');
                if (storedUserId && !storedUserId.startsWith('anon-')) {
                    showPage('main');
                } else {
                    showPage('login');
                }
            }
        });
    </script>
</body>
</html>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const imgContainer = document.querySelector('.product-image-container img');
    if (imgContainer) {
        imgContainer.addEventListener('click', () => {
            imgContainer.classList.toggle('zoomed');
        });
    }
});
</script>
<style>
.product-image-container img.zoomed {
    transform: scale(1.5);
    cursor: zoom-out;
}
</style>